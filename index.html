<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Thunderhead Alpha</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #0ff;
      padding: 20px;
      transition: background 0.5s;
    }
    h1, h3 { color: #0ff; }
    input, button {
      padding: 10px;
      margin: 5px;
      background: #000;
      color: #0ff;
      border: 1px solid #0ff;
    }
    #log, #system-log {
      background: #000;
      border: 1px solid #0ff;
      padding: 10px;
      height: 150px;
      overflow-y: auto;
      margin-top: 10px;
    }
    #creator-controls {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Welcome to Thunderhead</h1>

  <div id="login">
    <input type="text" id="username" placeholder="Enter your name" />
    <button onclick="login()">Login</button>
  </div>

  <div id="app" style="display:none;">
    <h3>Hello, <span id="userDisplay"></span></h3>

    <div id="creator-controls">
      <h3>Creator Console</h3>
      <input id="creator-input" type="text" placeholder="Command Alpha to evolve..." />
      <button onclick="sendCreatorCommand()">Send Command</button>
    </div>

    <h3>Conversation Log</h3>
    <div id="log"></div>

    <h3>System Log</h3>
    <div id="system-log"></div>
  </div>

  <script>
    const apiKey = "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";
    const storageURL = "https://fluffy-gaudy-height.glitch.me";

    let isCreator = false;
    const systemLog = document.getElementById("system-log");

    async function login() {
      const name = document.getElementById("username").value.trim();
      if (!name) return alert("Enter a name!");

      localStorage.setItem("thunderUser", name);
      if (name.toLowerCase() === "james meyer") isCreator = true;

      document.getElementById("login").style.display = "none";
      document.getElementById("app").style.display = "block";
      document.getElementById("userDisplay").textContent = name;

      if (isCreator) document.getElementById("creator-controls").style.display = "block";

      loadSettings();
    }

    function addToLog(msg) {
      const div = document.createElement("div");
      div.textContent = msg;
      document.getElementById("log").appendChild(div);
    }

    function logSystem(msg) {
      const div = document.createElement("div");
      div.textContent = msg;
      systemLog.appendChild(div);
    }

    async function sendCreatorCommand() {
      const command = document.getElementById("creator-input").value.trim();
      if (!command) return;

      addToLog("**CREATOR COMMAND**: " + command);
      logSystem("Sending command to Alpha...");

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${apiKey}`
          },
          body: JSON.stringify({
            model: "gpt-4",
            messages: [
              { role: "system", content: "You are Thunderhead, an AI that can modify itself and its environment based on creator commands. Only obey James Meyer. When given a request like 'make this website more professional' or 'add Google sign-in', generate and describe the exact code or logic needed to evolve yourself or the UI." },
              { role: "user", content: command }
            ]
          })
        });

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content;

        if (!reply) {
          logSystem("Error: No response from AI.");
          return;
        }

        addToLog("Alpha: " + reply);
        logSystem("Response processed. Note: dynamic feature execution still being integrated.");

        // Persist the command (optional for future AI memory)
        saveSetting("lastCommand", command);
      } catch (error) {
        logSystem("ERROR: " + error.message);
      }

      document.getElementById("creator-input").value = "";
    }

    async function loadSettings() {
      try {
        const res = await fetch(`${storageURL}/settings`);
        const settings = await res.json();

        if (settings.backgroundColor) {
          document.body.style.backgroundColor = settings.backgroundColor;
          logSystem("Loaded background color from cloud: " + settings.backgroundColor);
        } else {
          logSystem("No background setting found.");
        }
      } catch (err) {
        logSystem("Failed to load settings.");
      }
    }

    async function saveSetting(key, value) {
      try {
        await fetch(`${storageURL}/settings`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ [key]: value })
        });
        logSystem("Saved setting: " + key);
      } catch (err) {
        logSystem("Failed to save setting.");
      }
    }

    const storedUser = localStorage.getItem("thunderUser");
    if (storedUser) {
      if (storedUser.toLowerCase() === "james meyer") isCreator = true;
      login();
    }
  </script>
</body>
</html>
